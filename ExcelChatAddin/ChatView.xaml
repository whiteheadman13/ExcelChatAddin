<UserControl x:Class="ExcelChatAddin.ChatView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             MinWidth="200"
             MinHeight="200">

    <Grid Margin="8">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- ヘッダ -->
            <RowDefinition Height="*"/>
            <!-- チャット履歴 -->
            <RowDefinition Height="Auto"/>
            <!-- マスキング操作（👁） -->
            <RowDefinition Height="120"/>
            <!-- マスキングプレビュー -->
            <RowDefinition Height="Auto"/>
            <!-- 入力＋送信 -->
        </Grid.RowDefinitions>

        <!-- ============================= -->
        <!-- ヘッダ -->
        <!-- ============================= -->
        <TextBlock Grid.Row="0"
                   Text="指示（中央：チャット履歴 / 下：入力）"
                   FontWeight="Bold"
                   Margin="0,0,0,6"/>

        <!-- ============================= -->
        <!-- チャット履歴（表示専用） -->
        <!-- ============================= -->
        <TextBox x:Name="ChatHistoryBox"
                 Grid.Row="1"
                 Margin="0,0,0,6"
                 IsReadOnly="True"
                 AcceptsReturn="True"
                 TextWrapping="Wrap"
                 VerticalScrollBarVisibility="Auto"
                 Background="#FFF8F8F8"
                 BorderBrush="#FFCCCCCC"
                 BorderThickness="1"
                 Padding="6"/>

        <!-- ============================= -->
        <!-- マスキング操作（入力欄の上：右寄せ） -->
        <!-- ============================= -->
        <StackPanel Grid.Row="2"
                    Orientation="Horizontal"
                    HorizontalAlignment="Right"
                    Margin="0,0,0,4">
            <Button Content="👁"
                    Width="36"
                    Height="28"
                    ToolTip="入力内容のマスキング確認"
                    Click="BtnMaskPreview_Click"/>
        </StackPanel>

        <!-- ============================= -->
        <!-- マスキングプレビュー（表示専用） -->
        <!-- ============================= -->
        <RichTextBox x:Name="PreviewBox"
                     Grid.Row="3"
                     IsReadOnly="True"
                     IsDocumentEnabled="True"
                     VerticalScrollBarVisibility="Auto"
                     BorderThickness="1"
                     Padding="4"
                     FontSize="16"/>

        <!-- ============================= -->
        <!-- 入力欄 ＋ Gemini送信（入力右） -->
        <!-- ============================= -->
        <Grid Grid.Row="4" Margin="0,6,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <!-- 入力欄 -->
            <TextBox x:Name="InputBox"
                     Grid.Column="0"
                     AcceptsReturn="True"
                     PreviewKeyDown="InputBox_PreviewKeyDown"
                     TextWrapping="Wrap"
                     VerticalScrollBarVisibility="Auto"
                     BorderThickness="1"
                     Padding="8"
                     FontSize="16"
                     TextChanged="InputBox_TextChanged">
                <TextBox.ContextMenu>
                    <ContextMenu>
                        <MenuItem Header="選択文字列をマスキング登録"
                                  Click="MenuRegisterMask_Click"/>
                    </ContextMenu>
                </TextBox.ContextMenu>
            </TextBox>

            <!-- 送信ボタン -->
            <Button x:Name="btnSendGemini"
                    Grid.Column="1"
                    Content="送信"
                    Margin="6,0,0,0"
                    Padding="16,8"
                    FontSize="16"
                    Click="btnSendGemini_Click"/>
        </Grid>

    </Grid>

</UserControl>
